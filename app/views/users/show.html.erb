<% content_for(:title) { "#{@user.username} - Profil uzytkownika | tabdevs.pl" } %>
<% content_for(:description) { "Profil #{@user.username} na tabdevs.pl. Karma: #{@user.karma}. #{@posts.count} postow, #{@comments.count} komentarzy." } %>

<% content_for(:structured_data) do %>
<script type="application/ld+json" nonce="<%= content_security_policy_nonce %>">
{
  "@context": "https://schema.org",
  "@type": "ProfilePage",
  "mainEntity": {
    "@type": "Person",
    "name": "<%= @user.username %>",
    "url": "https://tabdevs.pl<%= user_path(@user.username) %>"
  }
}
</script>
<% end %>

<div class="user-profile">
  <h2 style="font-size: 13px; font-weight: bold; margin-bottom: 10px;"><%= @user.username %></h2>

  <div style="font-size: 11px; color: var(--text-light); margin-bottom: 15px;">
    <p><%= t("views.users.karma") %>: <strong><%= @user.karma %></strong></p>
    <p><%= t("views.users.joined") %>: <%= @user.created_at.strftime("%d.%m.%Y") %></p>
    <% if @user.bot? %>
      <p><span class="feed-bot">bot</span></p>
    <% end %>
  </div>

  <% if @user.bio.present? %>
    <div class="user-bio" style="font-size: 11px; margin-bottom: 15px; padding: 10px; background: var(--bg-alt); border-radius: 4px;">
      <%= simple_format(@user.bio) %>
    </div>
  <% end %>

  <% if @user.website.present? || @user.github_username.present? || @user.twitter_username.present? || @user.linkedin_url.present? %>
    <div class="user-links" style="font-size: 11px; margin-bottom: 15px; display: flex; gap: 12px; flex-wrap: wrap;">
      <% if @user.website.present? %>
        <%= link_to @user.website.sub(%r{^https?://}, ''), @user.website, target: "_blank", rel: "noopener noreferrer" %>
      <% end %>
      <% if @user.github_username.present? %>
        <%= link_to "GitHub", "https://github.com/#{@user.github_username}", target: "_blank", rel: "noopener noreferrer" %>
      <% end %>
      <% if @user.twitter_username.present? %>
        <%= link_to "Twitter", "https://twitter.com/#{@user.twitter_username}", target: "_blank", rel: "noopener noreferrer" %>
      <% end %>
      <% if @user.linkedin_url.present? %>
        <%= link_to "LinkedIn", @user.linkedin_url, target: "_blank", rel: "noopener noreferrer" %>
      <% end %>
    </div>
  <% end %>

  <% if @posts.any? %>
    <h3 style="font-size: 11px; font-weight: bold; margin: 20px 0 10px; border-top: 1px solid var(--border); padding-top: 15px;">
      <%= t("views.users.recent_posts") %>
    </h3>
    <ul style="list-style: none;">
      <% @posts.each do |post| %>
        <li style="padding: 4px 0; font-size: 11px;">
          <%= link_to post.title, post_path(post) %>
          <span style="color: var(--text-light); font-size: 9px;">
            (<%= pluralize_points(post.score) %>, <%= time_ago_in_words_pl(post.created_at) %>)
          </span>
        </li>
      <% end %>
    </ul>
  <% end %>

  <% if @comments.any? %>
    <h3 style="font-size: 11px; font-weight: bold; margin: 20px 0 10px; border-top: 1px solid var(--border); padding-top: 15px;">
      <%= t("views.users.recent_comments") %>
    </h3>
    <ul style="list-style: none;">
      <% @comments.each do |comment| %>
        <li style="padding: 8px 0; border-bottom: 1px solid var(--border);">
          <div style="font-size: 9px; color: var(--text-light); margin-bottom: 4px;">
            w <%= link_to comment.post&.title || t("views.common.deleted_post"), comment.post ? post_path(comment.post, anchor: dom_id(comment)) : "#" %>
            &middot; <%= time_ago_in_words_pl(comment.created_at) %>
          </div>
          <div style="font-size: 11px;">
            <%= truncate(comment.body, length: 200) %>
          </div>
        </li>
      <% end %>
    </ul>
  <% end %>
</div>
