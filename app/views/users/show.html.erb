<% content_for(:title) { "#{@user.username} - Profil użytkownika | tabdevs.pl" } %>
<% content_for(:description) { "Profil #{@user.username} na tabdevs.pl. Karma: #{@user.karma}. #{@posts.count} postów, #{@comments.count} komentarzy." } %>

<% content_for(:structured_data) do %>
<script type="application/ld+json" nonce="<%= content_security_policy_nonce %>">
{
  "@context": "https://schema.org",
  "@type": "ProfilePage",
  "mainEntity": {
    "@type": "Person",
    "name": "<%= @user.username %>",
    "url": "https://tabdevs.pl<%= user_path(@user.username) %>"
  }
}
</script>
<% end %>

<div class="user-profile">
  <h2 class="user-profile-header"><%= @user.username %></h2>

  <div class="user-profile-meta">
    <p><%= t("views.users.karma") %>: <strong><%= @user.karma %></strong></p>
    <p><%= t("views.users.joined") %>: <%= @user.created_at.strftime("%d.%m.%Y") %></p>
    <% if @user.bot? %>
      <p><span class="feed-bot">bot</span></p>
    <% end %>
  </div>

  <% if @user.bio.present? %>
    <div class="user-profile-bio">
      <%= simple_format(@user.bio) %>
    </div>
  <% end %>

  <% if @user.website.present? || @user.github_username.present? || @user.twitter_username.present? || @user.linkedin_url.present? %>
    <div class="user-profile-links">
      <% if @user.website.present? %>
        <%= link_to @user.website.sub(%r{^https?://}, ''), @user.website, target: "_blank", rel: "noopener noreferrer" %>
      <% end %>
      <% if @user.github_username.present? %>
        <%= link_to "GitHub", "https://github.com/#{@user.github_username}", target: "_blank", rel: "noopener noreferrer" %>
      <% end %>
      <% if @user.twitter_username.present? %>
        <%= link_to "Twitter", "https://twitter.com/#{@user.twitter_username}", target: "_blank", rel: "noopener noreferrer" %>
      <% end %>
      <% if @user.linkedin_url.present? %>
        <%= link_to "LinkedIn", @user.linkedin_url, target: "_blank", rel: "noopener noreferrer" %>
      <% end %>
    </div>
  <% end %>

  <% if @posts.any? %>
    <h3 class="user-profile-section"><%= t("views.users.recent_posts") %></h3>
    <ul class="user-profile-list">
      <% @posts.each do |post| %>
        <li>
          <%= link_to post.title, post_path(post) %>
          <span class="meta">(<%= pluralize_points(post.score) %>, <%= time_ago_in_words_pl(post.created_at) %>)</span>
        </li>
      <% end %>
    </ul>
  <% end %>

  <% if @comments.any? %>
    <h3 class="user-profile-section"><%= t("views.users.recent_comments") %></h3>
    <ul class="user-profile-list">
      <% @comments.each do |comment| %>
        <li class="user-comment-item">
          <div class="meta">
            w <%= link_to comment.post&.title || t("views.common.deleted_post"), comment.post ? post_path(comment.post, anchor: dom_id(comment)) : "#" %>
            &middot; <%= time_ago_in_words_pl(comment.created_at) %>
          </div>
          <div class="body">
            <%= truncate(comment.body, length: 200) %>
          </div>
        </li>
      <% end %>
    </ul>
  <% end %>
</div>
